# Preamble

## Approval

*The approval for pentesting the system with the IP addresses 10.1.0.5 and fd01::5 located at the DHBW Mannheim was given by Prof. Dr. Johannes Bauer.*

## Confidentiality Notice

*This report contains sensitive, privileged, and confidential information. Precautions should be taken to protect the confidentiality of the information in this document. Publication of this report may cause reputational damage to the DHBW Mannheim or facilitate attacks against the DHBW Mannheim. \censor{Philipp Fruck} and \censor{Pius Walter} shall not be held liable for special, incidental, collateral or consequential damages arising out of the use of this information.*

## Disclaimer

*Note that this assessment may not disclose all vulnerabilities that are present on the systems within the scope of the engagement. This report is a summary of the findings from a "point-in-time" assessment made on the server with the given IP addresses 10.1.0.5 and fd01::5. Any changes made to the environment during the period of testing may affect the results of the assessment.*


# Introduction

## Executive Summary

An attacker is able to brute force the simple password of the user `bluey`. This allows him to easily log in to the system and consequently escalate the highest system privileges (`root`) through an existing misconfiguration on the system.

In addition to the possibility of brute force via SSH, access to system files and thus to the password hash values of the user can be gained through a misconfiguration of the proxy service. In this way, the attacker can crack the passwords on his local system without a connection to the server and therefore gain access within a few seconds.

Furthermore, all connections to the server are highly susceptible to eavesdropping due to the use of severely outdated encryption and cryptography software packages. There also is a possibility to use a root shell with weak authentication through the poorly secured management server. Further there are users on the server which can escalate their privileges through SSH.

## Statement of Work

This pentest report was created as part of Offensive Security's examination in the summer semester of 2022.

## Samples

The scope of the pentest are the two IP addresses 10.1.0.5 and fd01::5 which are mapped to the same machine. The pentest was initiated as a black box test since there was no information provided except for the IP addresses.


# Classification Definitions

## Risk Classification

The following table shows the breakdown of the vulnerabilities found into these categories.

Level                                   | Score | Description
|----------|-----|--------------------------------------------------|
\cellcolor{risklevelcritical}{Critical} | 5     | The vulnerability poses an immediate threat. Remediation of the vulnerability should take place immediately. |
\cellcolor{risklevelhigh}{High}         | 4     | The vulnerability poses an urgent threat and its remediation should be prioritized. |
\cellcolor{risklevelmedium}{Medium}     | 3     | Successful exploitation is possible and can lead to a significant disruption in the functioning of systems. This vulnerability should be addressed as soon as possible. |
\cellcolor{risklevellow}{Low}           | 2     | The vulnerability poses a negligible/minor threat. The presence of this vulnerability should be noted and remediated if possible. |
\cellcolor{gray}{Information}           | 1     | These findings do not pose a clear threat, but may result in function being compromised or sensitive information being disclosed. |


# Summary of Findings

## Summary

| **Critical** | **High** | **Medium** | **Low** | **Information** |
|:-:|:-:|:-:|:-:|:-:|
| **\textcolor{risklevelcritical}{13}** | **\textcolor{risklevelhigh}{11}** | **\textcolor{risklevelmedium}{8}** | **\textcolor{risklevellow}{4}** | **\textcolor{gray}{15}** |

| **Finding** | **Description** | **Severity** |
|--|-----|---|
| \rowcolor{risklevelcritical}{OS-9} | sudoers File Permissions | Critical (5) |
| \rowcolor{risklevelcritical}{OS-10} | sudoers File Configuration | Critical (5) |
| \rowcolor{risklevelcritical}{OS-13} | Deactivated Accounts with SSH Access | Critical (5) |
| \rowcolor{risklevelcritical}{OS-14} | Missing Debian Security Repos | Critical (5) |
| \rowcolor{risklevelcritical}{OS-15} | Missing Server Security Updates | Critical (5) |
| \rowcolor{risklevelcritical}{OS-16} | Missing Software Security Updates | Critical (5) |
| \rowcolor{risklevelcritical}{OS-26} | Webserver exposes directory | Critical (5) |
| \rowcolor{risklevelcritical}{OS-29} | Management Server does not validate certificates | Critical (5) |
| \rowcolor{risklevelcritical}{OS-30} | Instant root shell | Critical (5) |
| \rowcolor{risklevelcritical}{OS-31} | Socat exposes the OpenSSL server | Critical (5) |
| \rowcolor{risklevelcritical}{OS-38} | Legacy OpenSSL | Critical (5) |
| \rowcolor{risklevelcritical}{OS-40} | Heartbleed | Critical (5) |
| \rowcolor{risklevelcritical}{OS-41} | Legacy OpenSSL has SSL enabled | Critical (5) |
| \rowcolor{risklevelhigh}{OS-5} | Weak Passwords | High (4) |
| \rowcolor{risklevelhigh}{OS-7} | Weak Certificates | High (4) |
| \rowcolor{risklevelhigh}{OS-18} | SSH brute-force | High (4) |
| \rowcolor{risklevelhigh}{OS-25} | Exposed CA-Certificate | High (4) |
| \rowcolor{risklevelhigh}{OS-28} | Management Server exposes CA-certificate | High (4) |
| \rowcolor{risklevelhigh}{OS-32} | Weak password hashing algorithm | High (4) |
| \rowcolor{risklevelhigh}{OS-33} | Suspicious snakeoil certificate | High (4) |
| \rowcolor{risklevelhigh}{OS-39} | Outdated OpenSSL config | High (4) |
| \rowcolor{risklevelhigh}{OS-42} | Legacy OpenSSL uses outdated TLS version | High (4) |
| \rowcolor{risklevelhigh}{OS-43} | Legacy OpenSSL ciphers | High (4) |
| \rowcolor{risklevelhigh}{OS-46} | IP6Tables not configured | High (4) |
| \rowcolor{risklevelmedium}{OS-1} | Unencrypted Web Traffic | Medium (3) |
| \rowcolor{risklevelmedium}{OS-4} | Directory Listing | Medium (3) |
| \rowcolor{risklevelmedium}{OS-8} | Root Certificates | Medium (3) |
| \rowcolor{risklevelmedium}{OS-22} | Apache has no TLS support | Medium (3) |
| \rowcolor{risklevelmedium}{OS-23} | Apache directory listing | Medium (3) |
| \rowcolor{risklevelmedium}{OS-24} | Weak certificate | Medium (3) |
| \rowcolor{risklevelmedium}{OS-27} | Management Server uses weak certificate | Medium (3) |
| \rowcolor{risklevelmedium}{OS-51} | System entropy is lower as expected | Medium (3) |
| \rowcolor{risklevellow}{OS-3} | Different IPv4 and IPv6 Firewall Rulesets | Low (2) |
| \rowcolor{risklevellow}{OS-20} | SSH password authentication | Low (2) |
| \rowcolor{risklevellow}{OS-47} | DNS uses public search domain | Low (2) |
| \rowcolor{risklevellow}{OS-49} | No hard disk encryption | Low (2) |
| \rowcolor{gray}{OS-2} | SSH Standard Port | Information (1) |
| \rowcolor{gray}{OS-6} | Certificate and Key Timestamps | Information (1) |
| \rowcolor{gray}{OS-11} | Unusual Files | Information (1) |
| \rowcolor{gray}{OS-12} | Root SSH Key | Information (1) |
| \rowcolor{gray}{OS-17} | Improper Systemd Service Permissions | Information (1) |
| \rowcolor{gray}{OS-19} | SSH root login | Information (1) |
| \rowcolor{gray}{OS-21} | Fail2ban is not installed | Information (1) |
| \rowcolor{gray}{OS-34} | Improper hostname resolution | Information (1) |
| \rowcolor{gray}{OS-35} | JBIN Collection | Information (1) |
| \rowcolor{gray}{OS-36} | NSA Heartbeat binary | Information (1) |
| \rowcolor{gray}{OS-37} | NSA Firmware Update binary | Information (1) |
| \rowcolor{gray}{OS-44} | Legacy OpenSSL key exchange groups | Information (1) |
| \rowcolor{gray}{OS-45} | UFW not installed | Information (1) |
| \rowcolor{gray}{OS-48} | BIOS instead of UEFI | Information (1) |
| \rowcolor{gray}{OS-50} | Bootloader is not password protected | Information (1) |

## Enumeration of Findings

### OS-1: Unencrypted Web Traffic

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** The traffic between client and server on TCP4 and TCP6 port `80` is unencrypted and can be sniffed by an attacker.

**Suggested Remediation:** Enable encrypted connections with TLS certificates and state-of-the-art ciphers.

---

### OS-2: SSH Standard Port

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** The SSH server is listening on the default port `22` which makes a script kiddie easier to brute force.

**Suggested Remediation:** SSH port could be changed to some arbitrary port in the higher port range.

---

### OS-3: Different IPv4 and IPv6 Firewall Rulesets

**Severity: \textcolor{risklevellow}{ Low (2) }**

**Description:** The IPv4 and IPv6 firewall rulesets are different. This makes it hard to maintain.

**Suggested Remediation:** Use consistent firewall rules for IPv4 and IPv6.

---

### OS-4: Directory Listing

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** The Apache2 web server has the standard directory listing enabled. This makes it easy for attacker to check the files containing in the web servers root folder. Further the users home directory names are publicly visible.

**Suggested Remediation:** Turn off directory listing or turn off web server entirely.

---

### OS-5: Weak Passwords

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** There are users on the server with weak passwords. For example the password of user `bluey` is crackable in around 10 seconds.

**Suggested Remediation:** Change passwords and enforce global password policies.

---

### OS-6: Certificate and Key Timestamps

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** There are certificates and keys on the server where the key is modified more than one and a half year after the certificate itself. However, the key and the certificate fit together.

**Suggested Remediation:** Check misconfigured or manipulated timestamps on the system. Maybe enable some audit history log.

---

### OS-7: Weak Certificates

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** There are multiple weak certificates using `sha1WithRSAEncryption` which is inherently insecure. Furthermore, the public key has a length of 2048 bit which currently is the recommended minimum length.

**Suggested Remediation:** Generate new certificates using state-of-the-art cryptography.

---

### OS-8: Root Certificates

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** Services expose their root CA certificates.

**Suggested Remediation:** Recreate certificates with `CA:FALSE` restriction parameter.

---

### OS-9: sudoers File Permissions

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** Instead of the default permissions (`440`) the file has a permission of `644` which means that the file is world readable to every user on the system. Due to the Dirty Pipe vulnerability every user on the system can append text to the `sudoers` file.

**Suggested Remediation:** Change the permissions of the `sudoers` file to `440`.

---

### OS-10: sudoers File Configuration

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The user `bluey` is allowed to use the `less` command with root privileges without any password against the `/var/log/auth.log` file. Since `less` is an interactive command line tool the user is able to execute sub-processes in an interactive root shell or open restricted files.

**Suggested Remediation:** Replace `less` with a non-interactive command like `cat` which can then be piped into less. Remove access entirely if not mandatory.

---

### OS-11: Unusual Files

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** A few unusual files we found in the root directory include the `.screenrc` and the `.inputrc` which are not created by default. Further, interesting files were the `.config/ marco-compton.conf`, the `.config/mpv/mpv.conf` and the `.xmodmaprc` which are used to configure a graphical environment and video player respectively. However, there is no graphical environment installed on the machine.

**Suggested Remediation:** Remove unnecessary files from the system.

---

### OS-12: Root SSH Key

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** The root user can log into the system using his own SSH key. This is not considered as a best practice because if the private user is only present for the root user and does not exist for any other user on any other machine it is useless to access a machine via SSH he already has shell access to. And if the private key is copied from another machine or another user, this is a bad practice as a private key should only be accessible to a single user at a single host.

**Suggested Remediation:** Remove roots SSH key from the `authorized_keys` file.

---

### OS-13: Deactivated Accounts with SSH Access

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** There are users on the server which are deactivated for login with a password. This does not mean that the user can not log in to the system. There is a valid SSH key for user `bingo` which allows him to log in as root user.

**Suggested Remediation:** Check if access is mandatory and remove access completely otherwise.

---

### OS-14: Missing Debian Security Repos

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** There are missing Debian security repos on the system. The `/etc/apt/sources.list` only contains one single repo. This means that there are no security updates for vulnerable software available.

**Suggested Remediation:** Add the Debian security repos to the `/etc/apt/sources.list` file.

---

### OS-15: Missing Server Security Updates

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The server is missing a lot of security updates which fixes many vulnerabilities.

**Suggested Remediation:** Search for available security updates by using `sudo apt update` and install them using `sudo apt upgrade`.

---

### OS-16: Missing Software Security Updates

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** There are updates available for many software packages on the server that fix critical vulnerabilities.

**Suggested Remediation:** Search for available software security updates by using `sudo apt update` and install them using `sudo apt upgrade`.

---

### OS-17: Improper Systemd Service Permissions

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** Some systemd services have their permissions set to `600` which is non-standard.

**Suggested Remediation:** Set permissions to the standard system settings using `644`.

---

### OS-18: SSH brute-force

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The SSH `MaxAuthRetries` option is set to `100000` which allows for password brute-forcing.

**Suggested Remediation:** Change the value of `MaxAuthRetries` to something reasonable for example `3` in the SSH configuration file.

---

### OS-19: SSH root login

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** SSH login is not disabled for the root user.

**Suggested Remediation:** Disable SSH login for the root user.

---

### OS-20: SSH password authentication

**Severity: \textcolor{risklevellow}{ Low (2) }**

**Description:** Password authentication is enabled for the SSH server, but key authentication should be enforced.

**Suggested Remediation:** Enforce key authentication for the SSH server in the configuration file.

---

### OS-21: Fail2ban is not installed

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** Fail2ban is not installed and configured for the SSH server.

**Suggested Remediation:** Install and configure Fail2ban.

---

### OS-22: Apache has no TLS support

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** Neither the `mod_ssl` nor the `mod_gnutls` module are enabled for `apache2`.

**Suggested Remediation:** Enable modules for TLS support for Apache2.

---

### OS-23: Apache directory listing

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** The default Apache directory listing is exposing the names of the users on the server.

**Suggested Remediation:** Disable Apache2 directory listing, use `htaccess` to forbid access to directories directly or remove Apache2 entirely if not necessary.

---

### OS-24: Weak certificate

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** The certificate used by the `drsfowp` service uses a weak signature algorithm.

**Suggested Remediation:** Recreate the certificate for the service with state-of-the-art cryptography.

---

### OS-25: Exposed CA-Certificate

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The `drsfowp` service publicly presents its CA-Certificate.

**Suggested Remediation:** Recreate the certificate with `CA:FALSE` parameter.

---

### OS-26: Webserver exposes directory

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The `/etc/` directory is exposed by the `drsfowp` service on port 443.

**Suggested Remediation:** Stop and remove service if it is not necessary otherwise check for required functionality and stop exposing the `/etc/` directory.

---

### OS-27: Management Server uses weak certificate

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** The certificate used by the 'Secure management server' uses a weak signature algorithm.

**Suggested Remediation:** Recreate the certificate for the service with state-of-the-art cryptography.

---

### OS-28: Management Server exposes CA-certificate

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The 'Secure management server' publicly presents its CA-Certificate.

**Suggested Remediation:** Recreate the certificate with `CA:FALSE` parameter.

---

### OS-29: Management Server does not validate certificates

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The 'Secure management server' does not validate certificates.

**Suggested Remediation:** Properly implement certificate validation.

---

### OS-30: Instant root shell

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The 'Secure management server' provides an interactive root shell that can be opened from anywhere.

**Suggested Remediation:** Disable the command execution functionality of the management server. Stop it entirely or hide in behind the firewall if possible.

---

### OS-31: Socat exposes the OpenSSL server

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The `socat` tool is used to expose the OpenSSL server which itself exposes the `/etc` directory.

**Suggested Remediation:** Stop the tool entirely or hide in behind the firewall.

---

### OS-32: Weak password hashing algorithm

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The password of user `bluey` is using a weak hashing algorithm.

**Suggested Remediation:** Recreate the password using a secure hashing algorithm.

---

### OS-33: Suspicious snakeoil certificate

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The snakeoil certificate used for unattended package installation is not the default Debian one but instead a custom certificate.

**Suggested Remediation:** Check the system integrity and make sure the certificate is intended to be a custom one. Recreate the snakeoil private key and certificate if not. Also remove the file the snakeoil certificate is symlinked to.

---

### OS-34: Improper hostname resolution

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** The hostname of the server cannot be resolved.

**Suggested Remediation:** Properly configure the `/etc/hosts` file by adding the hostname to it.

---

### OS-35: JBIN Collection

**Severity: \textcolor{gray}{ Information ($-e^{i \times \pi}$) }**

**Description:** The `jbin` collection is installed on the system.

**Suggested Remediation:** Remove it if not necessary.

---

### OS-36: NSA Heartbeat binary

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** A binary named `heartbeat` which is talking to the NSA servers is present on the server. It is never executed.

**Suggested Remediation:** Check if this file is necessary otherwise remove it. Figure out the origin of the file and check for system integrity.

---

### OS-37: NSA Firmware Update binary

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** A binary named `firmware_update` which is talking to the NSA servers is present on the server. It is never executed.

**Suggested Remediation:** Check if this file is necessary otherwise remove it. Figure out the origin of the file and check for system integrity.

---

### OS-38: Legacy OpenSSL

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** A legacy, 10-year-old OpenSSL version is installed on the system.

**Suggested Remediation:** Remove the OpenSSL version completely and use the official once out of the Debian repos.

---

### OS-39: Outdated OpenSSL config

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The legacy OpenSSL version installed on the system uses a suboptimal configuration.

**Suggested Remediation:** Use the latest OpenSSL version with corresponding configuration file.

---

### OS-40: Heartbleed

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The legacy OpenSSL version installed on the system is affected by the heartbleed vulnerability.

**Suggested Remediation:** Remove legacy installation and use the up-to-date version from the Debian repos with heartbleed fixes.

---

### OS-41: Legacy OpenSSL has SSL enabled

**Severity: \textcolor{risklevelcritical}{ Critical (5) }**

**Description:** The legacy OpenSSL version installed on the system has SSL protocols enabled.

**Suggested Remediation:** Remove legacy installation and use the up-to-date version from the Debian repos with disabled SSL support. If it cannot be removed for some reason disable SSL in the legacy OpenSSL configuration file entirely.

---

### OS-42: Legacy OpenSSL uses outdated TLS version

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The legacy OpenSSL version installed on the system is using outdated TLS versions.

**Suggested Remediation:** Remove legacy installation and use the up-to-date version from the Debian repos. If it cannot be removed disable everything but TLSv1.2.

---

### OS-43: Legacy OpenSSL ciphers

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** The legacy OpenSSL version installed on the system is using outdated ciphers.

**Suggested Remediation:** Remove legacy installation and use the up-to-date version from the Debian repos. If it cannot be removed only activate and use secure state-of-the-art ciphers.

---

### OS-44: Legacy OpenSSL key exchange groups

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** The legacy OpenSSL version installed on the system is using a key exchange group that is reasonable, but could be improved.

**Suggested Remediation:** Remove legacy installation and use the up-to-date version from the Debian repos. Possibly use the improved key exchange group.

---

### OS-45: UFW not installed

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** The firewall rules for the system are managed using `iptables` which is more complicated to use than `ufw`.

**Suggested Remediation:** Figure out if using `ufw` is the better approach than `iptables`. If so install and configure the firewall rules.

---

### OS-46: IP6Tables not configured

**Severity: \textcolor{risklevelhigh}{ High (4) }**

**Description:** No rules have been configured in `ip6tables` which means that all services using IPv6 are open to the world.

**Suggested Remediation:** Check all firewall rules set in the IPv4 firewall ruleset and apply them to the IPv6 firewall ruleset.

---

### OS-47: DNS uses public search domain

**Severity: \textcolor{risklevellow}{ Low (2) }**

**Description:** The DNS is configured to use a public domain as search domain for the local network which can lead to an information disclosure.

**Suggested Remediation:** Change the DNS search domain to a local one.

---

### OS-48: BIOS instead of UEFI

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** The system is booting in BIOS mode instead of UEFI which means that secure boot cannot be enabled.

**Suggested Remediation:** Figure out if the system can switch from BIOS to UEFI.

---

### OS-49: No hard disk encryption

**Severity: \textcolor{risklevellow}{ Low (2) }**

**Description:** The hard disk of the machine is not encrypted which means that all files are readable to anyone with physical access to the machine.

**Suggested Remediation:** Check if using hard drive encryption is a viable option.

---

### OS-50: Bootloader is not password protected

**Severity: \textcolor{gray}{ Information (1) }**

**Description:** GRUB2 is not password protected which means that anybody can boot into the system.

**Suggested Remediation:** Set up a password for GRUB2.

---

### OS-51: System entropy is lower as expected

**Severity: \textcolor{risklevelmedium}{ Medium (3) }**

**Description:** The system entropy is way lower than expected which can lead to weakens the randomness of generated numbers.

**Suggested Remediation:** Figure out why system entropy is so low. Consider adding a hardware random number generator module.

---
